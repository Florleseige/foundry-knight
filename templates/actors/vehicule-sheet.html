<form class="mainFlex {{cssClass}}" autocomplete="off">

    {{!-- Sheet Header --}}
    <header class="sheet-header flexrow">
        <img class="profile-img" src="{{data.img}}" data-edit="img" title="{{data.name}}" />
        <div class="headerData">
            <div class="data">
                <h1 class="charname">
                    <input name="name" type="text" value="{{data.name}}" placeholder="{{localize "KNIGHT.Nom"}}" />
                </h1>

                <div class="pilote">
                    <span class="label">{{localize "KNIGHT.VEHICULE.Pilote"}}</span>
                    {{#if systemData.equipage.pilote.name}}
                        <span class="value">
                            {{systemData.equipage.pilote.name}}
                            <div class="gestionButton">
                                <a class="item-control pilote-edit" title="{{localize "KNIGHT.VEHICULE.PasserPassager"}}"><i class="fa-solid fa-user"></i></i></a>
                                <a class="item-control pilote-delete" title="{{localize "KNIGHT.VEHICULE.DeletePilote"}}"><i class="fas fa-trash"></i></a>
                            </div>
                        </span>
                    {{else}}
                        <span class="value">{{localize "KNIGHT.VEHICULE.PasPilote"}}</span>
                    {{/if}}
                </div>

                <div class="passagers">
                    <span class="label">{{localize "KNIGHT.VEHICULE.Passagers"}}</span>
                    {{#if (isEmpty this.data.system.equipage.passagers false)}}
                        <span class="value">{{localize "KNIGHT.VEHICULE.PasPassager"}}</span>
                    {{else}}
                        {{#each systemData.equipage.passagers as | key passager|}}
                            <span class="value" data-id="{{passager}}">
                                {{key.name}}
                                <div class="gestionButton">
                                    <a class="item-control passager-edit" title="{{localize "KNIGHT.VEHICULE.PasserPilote"}}"><i class="fa-solid fa-user"></i></i></a>
                                    <a class="item-control passager-delete" title="{{localize "KNIGHT.VEHICULE.DeletePassager"}}"><i class="fas fa-trash"></i></a>
                                </div>
                            </span>
                        {{/each}}
                    {{/if}}
                </div>
            </div>
        </div>
    </header>

    {{!-- MENU LATERAL  --}}
    <section class="menu">
        <section class="mainBlock">
            <div class="manoeuvrabilite">
                <div class="line">
                    <span class="label">{{localize "KNIGHT.VEHICULE.Manoeuvrabilite"}}</span>
                    <input type="number" name="system.manoeuvrabilite" value="{{systemData.manoeuvrabilite}}" />
                </div>
                <button type="action" class="jetPilotage">{{localize "KNIGHT.JETS.JetPilotage"}}</button>
            </div>
            <div class="passagers">
                <div class="line">
                    <span class="label">{{localize "KNIGHT.VEHICULE.Passagers"}}</span>
                    <input type="number" name="system.passagers" value="{{systemData.passagers}}" min="0" />
                </div>
            </div>
            <div class="vitesse">
                <div class="line">
                    <span class="label">{{localize "KNIGHT.VEHICULE.Vitesse"}}</span>
                    <input type="number" name="system.vitesse" value="{{systemData.vitesse}}" min="0" max="5" />
                </div>
            </div>
        </section>

        <section class="mainBlock">
            <div class="armure">
                <div class="line">
                    <span class="option {{#unless systemData.armure.optionDeploy}} withBorder {{else}} withoutBorder  {{/unless}}"><img src="systems/knight/assets/icons/option.svg" class="option" data-option="armure"></span>
                    <span class="label {{#unless systemData.armure.optionDeploy}} withBorder {{else}} withoutBorder  {{/unless}}">{{localize "KNIGHT.LATERAL.Armure"}}</span>
                    <input class="{{#unless systemData.armure.optionDeploy}} withBorder {{else}} withoutBorder  {{/unless}}" type="number" name="system.armure.value" min="0" max="{{systemData.armure.max}}" value="{{systemData.armure.value}}" />
                    <span class="separation {{#unless systemData.armure.optionDeploy}} withBorder {{else}} withoutBorder  {{/unless}}">/</span>
                    <span class="score {{#unless systemData.armure.optionDeploy}} withBorder {{/unless}}" title="{{systemData.armure.base}} + {{systemData.armure.bonusValue}} - {{systemData.armure.malusValue}} = {{systemData.armure.max}}">{{systemData.armure.max}}</span>
                </div>
                <div class="subLine {{#if systemData.armure.optionDeploy}} optionShow {{else}} optionHide {{/if}}">
                    <span class="label withBorder">{{localize "KNIGHT.AUTRE.Base"}}</span>
                    <input class="withBorder" type="number" name="system.armure.base" data-type="armure" min="0" value="{{systemData.armure.base}}" />
                </div>
            </div>

            <div class="energie">
                <div class="line">
                    <span class="option {{#unless systemData.energie.optionDeploy}} withBorder {{else}} withoutBorder  {{/unless}}"><img src="systems/knight/assets/icons/option.svg" class="option" data-option="energie"></span>
                    <span class="label {{#unless systemData.energie.optionDeploy}} withBorder {{else}} withoutBorder  {{/unless}}">{{localize "KNIGHT.LATERAL.Energie"}}</span>
                    <input class="{{#unless systemData.energie.optionDeploy}} withBorder {{else}} withoutBorder  {{/unless}}" type="number" name="system.energie.value" min="0" max="{{systemData.energie.max}}" value="{{systemData.energie.value}}" />
                    <span class="separation {{#unless systemData.energie.optionDeploy}} withBorder {{else}} withoutBorder  {{/unless}}">/</span>
                    <span class="score {{#unless systemData.energie.optionDeploy}} withBorder {{/unless}}" title="{{systemData.energie.base}} + {{systemData.energie.bonusValue}} - {{systemData.energie.malusValue}} = {{systemData.energie.max}}">{{systemData.energie.max}}</span>
                </div>
                <div class="subLine {{#if systemData.energie.optionDeploy}} optionShow {{else}} optionHide {{/if}}">
                    <span class="label withBorder">{{localize "KNIGHT.AUTRE.Base"}}</span>
                    <input class="withBorder" type="number" name="system.energie.base" data-type="energie" min="0" value="{{systemData.energie.base}}" />
                </div>
            </div>

            <div class="champDeForce">
                <div class="line">
                    <span class="option {{#unless systemData.champDeForce.optionDeploy}} withBorder {{else}} withoutBorder  {{/unless}}"><img src="systems/knight/assets/icons/option.svg" class="option" data-option="champDeForce"></span>
                    <span class="label {{#unless systemData.champDeForce.optionDeploy}} withBorder {{else}} withoutBorder  {{/unless}}" title="{{localize "KNIGHT.LATERAL.ChampDeForce"}}">{{localize "KNIGHT.LATERAL.ChampDeForce-short"}}</span>
                    <span class="score {{#unless systemData.champDeForce.optionDeploy}} withBorder {{/unless}}" title="{{systemData.champDeForce.base}} + {{systemData.champDeForce.bonusValue}} - {{systemData.champDeForce.malusValue}} = {{systemData.champDeForce.value}}">{{systemData.champDeForce.value}}</span>
                </div>
                <div class="subLine {{#if systemData.champDeForce.optionDeploy}} optionShow {{else}} optionHide {{/if}}">
                    <span class="label withBorder">{{localize "KNIGHT.AUTRE.Base"}}</span>
                    <input class="withBorder" type="number" name="system.champDeForce.base" data-type="champDeForce" min="0" value="{{systemData.champDeForce.base}}" />
                </div>
            </div>
        </section>

        <section class="mainBlock">
            <div class="reaction">
                <div class="line">
                    <span class="label">{{localize "KNIGHT.LATERAL.Reaction"}}</span>
                    <span class="score">{{systemData.reaction.value}}</span>
                </div>
            </div>

            <div class="defense">
                <div class="line">
                    <span class="label">{{localize "KNIGHT.LATERAL.Defense"}}</span>
                    <span class="score">{{systemData.defense.value}}</span>
                </div>
            </div>

            <div class="initiative">
                <div class="line">
                    <span class="label">{{localize "KNIGHT.LATERAL.Initiative"}}</span>
                    <span class="score">
                        {{systemData.initiative.dice}}{{localize "KNIGHT.JETS.Des-short"}}6+{{systemData.initiative.value}}
                    </span>
                </div>
            </div>
        </section>
    </section>

    {{!-- Sheet Body --}}
    <section class="body">
        {{!-- Sheet Tab Navigation --}}
        <nav class="sheet-tabs tabs" data-group="primary">
            <a class="item" data-tab="vehicule">{{localize "ACTOR.TypeVehicule"}}</a>
            <a class="item" data-tab="modules">{{localize "ITEM.TypeModule"}}</a>
            <a class="item" data-tab="combat">{{localize "KNIGHT.COMBAT.Label"}}</a>
        </nav>

        <div class="tab vehicule" data-group="primary" data-tab="vehicule">
            <div class="description">
                <h2 class="header">{{localize "KNIGHT.Description"}}</h2>

                {{editor systemData.description target="system.description" button=true owner=owner editable=editable}}
            </div>
        </div>

        <div class="tab modules" data-group="primary" data-tab="modules">
            <div class="main">
                <h2 class="header">
                    <i class="far fa-minus-square"></i>
                    {{localize "KNIGHT.ITEMS.MODULE.Label"}}

                    <a class="item-control item-create" title="Create Item" data-type="module"><i class="fas fa-plus"></i></a>
                </h2>

                {{#each actor.modules as | key module|}}
                <div class="bModule">
                    <header class="summary header" data-item-id="{{key._id}}">
                        <i class="far fa-plus-square extendButton"></i>

                        <div class="gestionButton">
                            <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
                            <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
                        </div>
                        <span>{{{key.name}}}</span>

                        <div class="blockMultiline">
                            {{#if (moduleCanBeActivate key)}}
                                {{#if (isLowerThan key.system.energie.tour.value 1)}}
                                    {{#if (isLowerThan key.system.energie.minute.value 1)}}
                                        {{#unless key.system.active.base}}
                                            <button class="activation" data-name="{{key.name}}" data-type="module" data-module="{{key._id}}"
                                                data-cout="0">
                                                {{localize "KNIGHT.AUTRE.Activer"}}
                                            </button>
                                        {{/unless}}
                                    {{/if}}
                                {{/if}}
                                {{#if (isHigherThan key.system.energie.tour.value 0)}}
                                    {{#unless key.system.active.base}}
                                        <button class="activation" data-name="{{key.name}}" data-type="module" data-module="{{key._id}}"
                                            data-cout="{{key.system.energie.tour.value}}">
                                            {{localize "KNIGHT.AUTRE.Activer"}} ({{key.system.energie.tour.label}})
                                        </button>
                                    {{/unless}}
                                {{/if}}
                                {{#if (isHigherThan key.system.energie.minute.value 0)}}
                                    {{#unless key.system.active.base}}
                                        <button class="activation" data-name="{{key.name}}" data-type="module" data-module="{{key._id}}"
                                            data-cout="{{key.system.energie.minute.value}}">
                                            {{localize "KNIGHT.AUTRE.Activer"}} ({{key.system.energie.minute.label}})
                                        </button>
                                    {{/unless}}
                                {{/if}}
                            {{/if}}
                            {{#if key.system.active.base}}
                                <button class="desactivation" data-name="{{key.name}}" data-type="module" data-module="{{key._id}}"
                                    data-cout="0">
                                        {{localize "KNIGHT.AUTRE.Desactiver"}}
                                </button>
                                {{#if (isHigherThan key.system.energie.supplementaire 0)}}
                                    <button class="supplementaire"
                                        data-cout="{{key.system.energie.supplementaire}}">
                                        {{localize "KNIGHT.ITEMS.MODULE.DepenseSupplementaire"}}
                                    </button>
                                {{/if}}
                            {{/if}}
                            {{#unless key.system.active.pnj}}
                                {{#each key.system.pnj.liste as | keyPnj pnj|}}
                                    {{#if (isHigherThan key.system.energie.tour.value 0)}}
                                        {{#unless key.system.active.pnj}}
                                            <button class="activation" data-name="{{key.name}}" data-type="modulePnj" data-module="{{key._id}}"
                                                data-cout="{{key.system.energie.tour.value}}" data-index="{{@index}}">
                                                {{localize "KNIGHT.AUTRE.Activer"}} : {{keyPnj.nom}} ({{localize "KNIGHT.AUTRE.Tour"}})
                                            </button>
                                        {{/unless}}
                                    {{/if}}

                                    {{#if (isHigherThan key.system.energie.minute.value 0)}}
                                        {{#unless key.system.active.pnj}}
                                            <button class="activation" data-name="{{key.name}}" data-type="modulePnj" data-module="{{key._id}}"
                                                data-cout="{{key.system.energie.minute.value}}" data-index="{{@index}}">
                                                {{localize "KNIGHT.AUTRE.Activer"}} : {{keyPnj.nom}} ({{localize "KNIGHT.AUTRE.Minute"}})
                                            </button>
                                        {{/unless}}
                                    {{/if}}
                                {{/each}}
                            {{/unless}}
                            {{#if key.system.active.pnj}}
                                <button class="desactivation" data-type="modulePnj" data-module="{{key._id}}"
                                    data-cout="0">
                                        {{localize "KNIGHT.AUTRE.Desactiver"}} : {{key.system.active.pnjName}}
                                </button>
                                {{#if (isHigherThan key.system.energie.supplementaire 0)}}
                                    <button class="supplementaire"
                                        data-cout="{{key.system.energie.supplementaire}}">
                                        {{localize "KNIGHT.ITEMS.MODULE.DepenseSupplementaire"}} : {{key.system.active.pnjName}}
                                    </button>
                                {{/if}}
                            {{/if}}
                        </div>
                    </header>

                    <img class="profile-img" style="display:none;" src="{{key.img}}" title="{{key.name}}" />
                    <span class="description" style="display:none;">{{{key.system.description}}}</span>

                    <div class="mainBlock" style="display:none;">
                        <div class="mSlots">
                            <h4 class="title">{{localize "KNIGHT.ITEMS.ARMURE.SLOTS.Label"}}</h4>

                            <div class="block">
                                <span class="title">{{localize "KNIGHT.ITEMS.ARMURE.SLOTS.Tete"}}</span>
                                <span class="score">{{key.system.slots.tete}}</span>
                            </div>

                            <div class="block">
                                <span class="title">{{localize "KNIGHT.ITEMS.ARMURE.SLOTS.BrasGauche"}}</span>
                                <span class="score">{{key.system.slots.brasGauche}}</span>
                            </div>

                            <div class="block">
                                <span class="title">{{localize "KNIGHT.ITEMS.ARMURE.SLOTS.BrasDroit"}}</span>
                                <span class="score">{{key.system.slots.brasDroit}}</span>
                            </div>

                            <div class="block">
                                <span class="title">{{localize "KNIGHT.ITEMS.ARMURE.SLOTS.Torse"}}</span>
                                <span class="score">{{key.system.slots.torse}}</span>
                            </div>

                            <div class="block">
                                <span class="title">{{localize "KNIGHT.ITEMS.ARMURE.SLOTS.JambeGauche"}}</span>
                                <span class="score">{{key.system.slots.jambeGauche}}</span>
                            </div>

                            <div class="block">
                                <span class="title">{{localize "KNIGHT.ITEMS.ARMURE.SLOTS.JambeDroite"}}</span>
                                <span class="score">{{key.system.slots.jambeDroite}}</span>
                            </div>
                        </div>

                        <div class="line">
                            <div class="data">
                                <div class="middlespan">
                                    <span class="header">{{localize "KNIGHT.ITEMS.MODULE.CATEGORIE.Label"}}</span>
                                    <span class="score">{{getCategorie key.system.categorie}}</span>
                                </div>
                                <div class="middlespan">
                                    <span class="header">{{localize "KNIGHT.ITEMS.MODULE.RARETE.Label"}}</span>
                                    <span class="score">{{getRarete key.system.rarete}}</span>
                                </div>
                                <div class="middlespan">
                                    <span class="header">{{localize "KNIGHT.ACTIVATION.Label"}}</span>
                                    <span class="score">{{getActivation key.system.activation}}</span>
                                </div>
                                {{#if (isHigherThan key.system.energie.tour.value 0)}}
                                <div class="middlespan">
                                    <span class="header">
                                        {{#unless @root/actor/armureData/system/espoir/remplaceEnergie}}
                                        {{localize "KNIGHT.LATERAL.Energie"}}
                                        {{else}}
                                        {{localize "KNIGHT.LATERAL.Espoir"}}
                                        {{/unless}} / {{key.system.energie.tour.label}}
                                    </span>
                                    <span class="score">{{key.system.energie.tour.value}}</span>
                                </div>
                                {{/if}}
                                {{#if (isHigherThan key.system.energie.minute.value 0)}}
                                <div class="middlespan">
                                    <span class="header">
                                        {{#unless @root/actor/armureData/system/espoir/remplaceEnergie}}
                                        {{localize "KNIGHT.LATERAL.Energie"}}
                                        {{else}}
                                        {{localize "KNIGHT.LATERAL.Espoir"}}
                                        {{/unless}} / {{key.system.energie.minute.label}}
                                    </span>
                                    <span class="score">{{key.system.energie.minute.value}}</span>
                                </div>
                                {{/if}}
                                {{#if (isHigherThan key.system.energie.supplementaire 0)}}
                                <div class="middlespan">
                                    <span class="header">
                                        {{#unless @root/actor/armureData/system/espoir/remplaceEnergie}}
                                        {{localize "KNIGHT.AUTRE.EnergieSupplementaireComplet"}}
                                        {{else}}
                                        {{localize "KNIGHT.LATERAL.EspoirSupplementaireComplet"}}
                                        {{/unless}}
                                    </span>
                                    <span class="score">{{key.system.energie.supplementaire}}</span>
                                </div>
                                {{/if}}
                                <div class="middlespan">
                                    <span class="header">{{localize "KNIGHT.PORTEE.Label"}}</span>
                                    <span class="score">{{getPortee key.system.portee}}</span>
                                </div>
                                <span class="oneLine lightBlack">{{localize "KNIGHT.DUREE.Label"}}</span>
                                {{#if key.system.permanent}}
                                <span class="button">{{localize "KNIGHT.DUREE.Permanent"}}</span>
                                {{else}}
                                <span class="textarea">{{{capaciteDescription key.system.duree}}}</span>
                                {{/if}}
                            </div>

                            {{#if key.system.bonus.has}}
                            <div class="data">
                                <h4 class="title">{{localize "KNIGHT.BONUS.Label"}}</h4>
                                {{#if key.system.bonus.armure.has}}
                                    <div class="middlespan">
                                        <span class="header">{{localize "KNIGHT.LATERAL.Armure"}}</span>
                                        <span class="score">{{key.system.bonus.armure.value}}</span>
                                    </div>
                                {{/if}}

                                {{#if key.system.bonus.champDeForce.has}}
                                    <div class="middlespan">
                                        <span class="header">{{localize "KNIGHT.LATERAL.ChampDeForce"}}</span>
                                        <span class="score">{{key.system.bonus.champDeForce.value}}</span>
                                    </div>
                                {{/if}}

                                {{#if key.system.bonus.energie.has}}
                                    <div class="middlespan">
                                        <span class="header">{{localize "KNIGHT.LATERAL.Energie"}}</span>
                                        <span class="score">{{key.system.bonus.energie.value}}</span>
                                    </div>
                                {{/if}}

                                {{#if key.system.bonus.energie.has}}
                                    <div class="middlespan">
                                        <span class="header">{{localize "KNIGHT.LATERAL.Energie"}}</span>
                                        <span class="score">{{key.system.bonus.energie.value}}</span>
                                    </div>
                                {{/if}}

                                {{#if key.system.bonus.degats.has}}
                                    <h4 class="separation">{{localize "KNIGHT.BONUS.Degats"}}</h4>
                                    <span class="oneLine borderBottom">{{getWpnType key.system.bonus.degats.type}}</span>
                                    {{#unless key.system.bonus.degats.variable.has}}
                                    <div class="middlespan noSeparation">
                                        <span class="header">{{localize "KNIGHT.AUTRE.Total"}}</span>
                                        <span class="score">{{key.system.bonus.degats.dice}}{{localize "KNIGHT.JETS.Des-short"}}6+{{key.system.bonus.degats.fixe}}</span>
                                    </div>
                                    {{else}}
                                    <div class="middlespan noSeparation">
                                        <span class="header">{{localize "KNIGHT.AUTRE.Minimum"}}</span>
                                        <span class="score">{{key.system.bonus.degats.variable.min.dice}}{{localize "KNIGHT.JETS.Des-short"}}6+{{key.system.bonus.degats.variable.min.fixe}}</span>
                                    </div>
                                    <div class="middlespan">
                                        <span class="header">{{localize "KNIGHT.AUTRE.Maximum"}}</span>
                                        <span class="score">{{key.system.bonus.degats.variable.max.dice}}{{localize "KNIGHT.JETS.Des-short"}}6+{{key.system.bonus.degats.variable.max.fixe}}</span>
                                    </div>
                                    {{/unless}}
                                {{/if}}

                                {{#if key.system.bonus.violence.has}}
                                    <h4 class="separation">{{localize "KNIGHT.BONUS.Violence"}}</h4>
                                    <span class="oneLine borderBottom">{{getWpnType key.system.bonus.violence.type}}</span>
                                    {{#unless key.system.bonus.violence.variable.has}}
                                    <div class="middlespan noSeparation">
                                        <span class="header">{{localize "KNIGHT.AUTRE.Total"}}</span>
                                        <span class="score">{{key.system.bonus.violence.dice}}{{localize "KNIGHT.JETS.Des-short"}}6+{{key.system.bonus.violence.fixe}}</span>
                                    </div>
                                    {{else}}
                                    <div class="middlespan noSeparation">
                                        <span class="header">{{localize "KNIGHT.AUTRE.Minimum"}}</span>
                                        <span class="score">{{key.system.bonus.violence.variable.min.dice}}{{localize "KNIGHT.JETS.Des-short"}}6+{{key.system.bonus.violence.variable.min.fixe}}</span>
                                    </div>
                                    <div class="middlespan">
                                        <span class="header">{{localize "KNIGHT.AUTRE.Maximum"}}</span>
                                        <span class="score">{{key.system.bonus.violence.variable.max.dice}}{{localize "KNIGHT.JETS.Des-short"}}6+{{key.system.bonus.violence.variable.max.fixe}}</span>
                                    </div>
                                    {{/unless}}
                                {{/if}}
                            </div>
                            {{/if}}

                            {{#if key.system.arme.has}}
                            <div class="data">
                                <h4 class="title">{{localize "KNIGHT.ITEMS.MODULE.ARME.Label"}}</h4>
                                <div class="middlespan">
                                    <span class="header">{{localize "KNIGHT.ITEMS.MODULE.ARME.TYPE.Label"}}</span>
                                    <span class="score">{{getWpnType key.system.arme.type}}</span>
                                </div>
                                <div class="middlespan">
                                    <span class="header">{{localize "KNIGHT.PORTEE.Label"}}</span>
                                    <span class="score">{{getPortee key.system.arme.portee}}</span>
                                </div>

                                <h4 class="separation">{{localize "KNIGHT.AUTRE.Degats"}}</h4>
                                {{#unless key.system.arme.degats.variable.has}}
                                <div class="middlespan noSeparation">
                                    <span class="header">{{localize "KNIGHT.AUTRE.Total"}}</span>
                                    <span class="score">{{key.system.arme.degats.dice}}{{localize "KNIGHT.JETS.Des-short"}}6+{{key.system.arme.degats.fixe}}</span>
                                </div>
                                {{else}}
                                <div class="middlespan noSeparation">
                                    <span class="header">{{localize "KNIGHT.AUTRE.Minimum"}}</span>
                                    <span class="score">{{key.system.arme.degats.variable.min.dice}}{{localize "KNIGHT.JETS.Des-short"}}6+{{key.system.arme.degats.variable.min.fixe}}</span>
                                </div>
                                <div class="middlespan">
                                    <span class="header">{{localize "KNIGHT.AUTRE.Maximum"}}</span>
                                    <span class="score">{{key.system.arme.degats.variable.max.dice}}{{localize "KNIGHT.JETS.Des-short"}}6+{{key.system.arme.degats.variable.max.fixe}}</span>
                                </div>
                                {{/unless}}

                                <h4 class="separation">{{localize "KNIGHT.AUTRE.Violence"}}</h4>
                                {{#unless key.system.arme.violence.variable.has}}
                                <div class="middlespan noSeparation">
                                    <span class="header">{{localize "KNIGHT.AUTRE.Total"}}</span>
                                    <span class="score">{{key.system.arme.violence.dice}}{{localize "KNIGHT.JETS.Des-short"}}6+{{key.system.arme.violence.fixe}}</span>
                                </div>
                                {{else}}
                                <div class="middlespan noSeparation">
                                    <span class="header">{{localize "KNIGHT.AUTRE.Minimum"}}</span>
                                    <span class="score">{{key.system.arme.violence.variable.min.dice}}{{localize "KNIGHT.JETS.Des-short"}}6+{{key.system.arme.violence.variable.min.fixe}}</span>
                                </div>
                                <div class="middlespan">
                                    <span class="header">{{localize "KNIGHT.AUTRE.Maximum"}}</span>
                                    <span class="score">{{key.system.arme.violence.variable.max.dice}}{{localize "KNIGHT.JETS.Des-short"}}6+{{key.system.arme.violence.variable.max.fixe}}</span>
                                </div>
                                {{/unless}}
                                <div class="effets">
                                    {{#each key.system.arme.effets.liste as | key effet|}}
                                        <div>
                                            <span class="label">{{key.name}}</span>
                                            <img class="info" src="systems/knight/assets/icons/info.svg" />
                                            <span class="hideInfo">{{{getEffetsDescription key.description}}}</span>
                                        </div>
                                    {{/each}}
                                </div>
                                {{#if (isWpnDistance key.system.arme.type)}}
                                <div class="effets">
                                    {{#each key.system.arme.distance.liste as | key effet|}}
                                        <div>
                                            <span class="label">{{key.name}}</span>
                                            <img class="info" src="systems/knight/assets/icons/info.svg" />
                                            <span class="hideInfo">{{{getEffetsDescription key.description}}}</span>
                                        </div>
                                    {{/each}}
                                </div>
                                {{else}}
                                <div class="effets">
                                    {{#each key.system.arme.structurelles.liste as | key effet|}}
                                        <div>
                                            <span class="label">{{key.name}}</span>
                                            <img class="info" src="systems/knight/assets/icons/info.svg" />
                                            <span class="hideInfo">{{{getEffetsDescription key.description}}}</span>
                                        </div>
                                    {{/each}}
                                </div>
                                <div class="effets">
                                    {{#each key.system.arme.ornementales.liste as | key effet|}}
                                        <div>
                                            <span class="label">{{key.name}}</span>
                                            <img class="info" src="systems/knight/assets/icons/info.svg" />
                                            <span class="hideInfo">{{{getEffetsDescription key.description}}}</span>
                                        </div>
                                    {{/each}}
                                </div>
                                {{/if}}
                            </div>
                            {{/if}}

                            {{#if key.system.pnj.has}}
                            <div class="data fullWidth pnj">
                                <h4 class="title">{{localize "KNIGHT.ITEMS.MODULE.PNJ.LabelP"}}</h4>
                                {{#each key.system.pnj.liste as | kPnj pnj|}}
                                    <div class="mainBlock">
                                        <span class="pnjName">{{kPnj.nom}} ({{getPnjType kPnj.type}})</span>
                                        {{#if kPnj.aspects.has}}
                                        <div class="aspects">
                                            {{#each kPnj.aspects.liste  as | kAsp aspect|}}
                                                <div>
                                                    <div class="middlespan noSeparation">
                                                        <span class="header">{{getAspect aspect}}</span>
                                                        <span class="score">{{kAsp.value}}</span>
                                                    </div>
                                                    <h4 class="separation">{{localize "KNIGHT.ASPECTS.Exceptionnels"}}</h4>
                                                    <div class="middlespan noSeparation">
                                                        <span class="header">{{localize "KNIGHT.AUTRE.Mineur"}}</span>
                                                        <span class="score">{{kAsp.ae.mineur}}</span>
                                                    </div>
                                                    <div class="middlespan">
                                                        <span class="header">{{localize "KNIGHT.AUTRE.Majeur"}}</span>
                                                        <span class="score">{{kAsp.ae.majeur}}</span>
                                                    </div>
                                                </div>
                                            {{/each}}
                                        </div>
                                        {{/if}}

                                        <div class="col3">
                                            {{#if (isBande kPnj.type)}}
                                                <div class="middlespan noSeparation">
                                                    <span class="header">{{localize "KNIGHT.AUTRE.Debordement"}}</span>
                                                    <span class="score">{{kPnj.debordement}}</span>
                                                </div>
                                            {{/if}}
                                            <div class="middlespan {{#unless (isBande kPnj.type)}}noSeparation{{/unless}}">
                                                <span class="header">{{localize "KNIGHT.LATERAL.Initiative"}}</span>
                                                <span class="score">{{kPnj.initiative.dice}}{{localize "KNIGHT.JETS.Des-short"}}6+{{kPnj.initiative.fixe}}</span>
                                            </div>
                                        </div>

                                        <div class="col3">
                                            <div class="middlespan noSeparation">
                                                <span class="header">{{localize "KNIGHT.LATERAL.Reaction"}}</span>
                                                <span class="score">{{kPnj.reaction}}</span>
                                            </div>
                                            <div class="middlespan">
                                                <span class="header">{{localize "KNIGHT.LATERAL.Defense"}}</span>
                                                <span class="score">{{kPnj.defense}}</span>
                                            </div>
                                        </div>

                                        <div class="col3">
                                            <div class="middlespan noSeparation">
                                                <span class="header">{{localize "KNIGHT.LATERAL.Armure"}}</span>
                                                <span class="score">{{kPnj.armure}}</span>
                                            </div>
                                            <div class="middlespan">
                                                <span class="header">{{localize "KNIGHT.LATERAL.ChampDeForce"}}</span>
                                                <span class="score">{{kPnj.champDeForce}}</span>
                                            </div>
                                        </div>

                                        {{#if kPnj.armes.has}}
                                        <div class="armes">
                                            <h4>
                                                {{localize "KNIGHT.ITEMS.MODULE.ARME.Label"}}
                                            </h3>
                                            {{#each kPnj.armes.liste  as | kArme arme|}}
                                            <div>
                                                <div class="line">
                                                    <span class="nom">
                                                        {{kArme.nom}}
                                                    </span>
                                                    <span class="type">
                                                        {{getWpnType kArme.type}}
                                                    </span>
                                                </div>
                                                <div class="header">
                                                    <span class="portee">{{localize "KNIGHT.PORTEE.Label"}}</span>
                                                    <span class="degats">{{localize "KNIGHT.AUTRE.Degats"}}</span>
                                                    <span class="violence">{{localize "KNIGHT.AUTRE.Violence"}}</span>
                                                </div>
                                                <div class="line">
                                                    <span class="portee">{{getPortee kArme.portee}}</span>
                                                    <span class="degats">{{kArme.degats.dice}}{{localize "KNIGHT.JETS.Des-short"}}6+{{kArme.degats.fixe}}</span>
                                                    <span class="violence">{{kArme.violence.dice}}{{localize "KNIGHT.JETS.Des-short"}}6+{{kArme.violence.fixe}}</span>
                                                </div>
                                                <div class="effets">
                                                    {{#each kArme.effets.liste as | kEffet effet|}}
                                                        <div>
                                                            <span class="label">{{kEffet.name}}</span>
                                                            <img class="info" src="systems/knight/assets/icons/info.svg" />
                                                            <span class="hideInfo">{{{getEffetsDescription kEffet.description}}}</span>
                                                        </div>
                                                    {{/each}}
                                                </div>
                                            </div>
                                            {{/each}}
                                        </div>
                                        {{/if}}
                                    </div>
                                {{/each}}
                            </div>
                            {{/if}}
                        </div>
                    </div>
                </div>
                {{/each}}
            </div>
        </div>


        <div class="tab combat" data-group="primary" data-tab="combat">
            <div class="main">
                <div class="armesDistance">
                    <div class="block">
                        <h2 class="header">
                            {{localize "KNIGHT.COMBAT.ARMES.DISTANCE.Label"}}
                            <a class="item-control item-create" title="Create Item" data-type="arme" data-subtype="distance"><i class="fas fa-plus"></i></a>
                        </h2>

                        {{#each actor.armesDistance as | key arme|}}
                            <div class="wpn">
                                <header class="summary header"  data-item-id="{{this._id}}">
                                    <i class="far fa-plus-square extendButton"></i>
                                    <div class="gestionButton">
                                        <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
                                        <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
                                    </div>
                                    <span class="name">{{this.name}}</span>
                                    <select class="whoActivate" data-id="{{this._id}}">
                                        {{#select this.system.whoActivate}}
                                        <option value=""></option>
                                            {{#each @root/data/system/equipage/passagers as | kPass passager|}}
                                                <option value="{{kPass.id}}">{{localize "KNIGHT.VEHICULE.ArmeUtiliseePar"}} : {{kPass.name}}</option>
                                            {{/each}}
                                        {{/select}}
                                    </select>
                                    <div class="line">
                                        <div class="doubleLine">
                                            <span class="header">{{localize "KNIGHT.PORTEE.Label"}}</span>
                                            <span>{{getPortee this.system.portee}}</span>
                                        </div>
                                        <div class="doubleLine">
                                            <span class="header">{{localize "KNIGHT.AUTRE.Degats"}}</span>
                                            <span>{{this.system.degats.dice}}{{localize "KNIGHT.JETS.Des-short"}}6+{{this.system.degats.fixe}}</span>
                                        </div>
                                        <div class="doubleLine">
                                            <span class="header">{{localize "KNIGHT.AUTRE.Violence"}}</span>
                                            <span>{{this.system.violence.dice}}{{localize "KNIGHT.JETS.Des-short"}}6+{{this.system.violence.fixe}}</span>
                                        </div>
                                        <img src="systems/knight/assets/icons/D6Black.svg" class="jetWpn dice" data-name="{{this.name}}" data-id="{{this._id}}" data-isDistance="{{this.system.type}}" data-num="{{@index}}" data-who="{{this.system.whoActivate}}" />
                                    </div>

                                </header>

                                <div class="effets" style="display:none;">
                                    <div class="blockEffets">
                                        {{#each this.system.effets.liste as | key effet|}}
                                            <div>
                                                <span class="label">{{key.name}}</span>
                                                <img class="info" src="systems/knight/assets/icons/info.svg" />
                                                <span class="hideInfo">{{{getEffetsDescription key.description}}}</span>
                                            </div>
                                        {{/each}}
                                    </div>
                                </div>
                                <div class="effets" style="display:none;">
                                    <div class="blockEffets">
                                        {{#each this.system.distance.liste as | key effet|}}
                                            <div>
                                                <span class="label">{{key.name}}</span>
                                                <img class="info" src="systems/knight/assets/icons/info.svg" />
                                                <span class="hideInfo">{{{getEffetsDescription key.description}}}</span>
                                            </div>
                                        {{/each}}
                                    </div>
                                </div>
                            </div>
                        {{/each}}
                    </div>
                </div>
            </div>
        </div>
    </section>
</form>